// Jest Snapshot v1, https://jestjs.io/docs/snapshot-testing

exports[`can use actions individually and in supported sequences 1`] = `
"type Query {
  identifyText(input: IdentifyTextInput!): String
  identifyLabels(input: IdentifyLabelsInput!): [String]
  convertTextToSpeech(input: ConvertTextToSpeechInput!): String
  translateText(input: TranslateTextInput!): String
  speakTranslatedIdentifiedText(input: SpeakTranslatedIdentifiedTextInput!): String
  speakTranslatedLabelText(input: SpeakTranslatedLabelTextInput!): String
  speakTranslatedText(input: SpeakTranslatedTextInput!): String
}

input IdentifyTextIdentifyTextInput {
  key: String!
}

input IdentifyTextInput {
  identifyText: IdentifyTextIdentifyTextInput!
}

input IdentifyLabelsIdentifyLabelsInput {
  key: String!
}

input IdentifyLabelsInput {
  identifyLabels: IdentifyLabelsIdentifyLabelsInput!
}

input ConvertTextToSpeechConvertTextToSpeechInput {
  voiceID: String!
  text: String!
}

input ConvertTextToSpeechInput {
  convertTextToSpeech: ConvertTextToSpeechConvertTextToSpeechInput!
}

input TranslateTextTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
  text: String!
}

input TranslateTextInput {
  translateText: TranslateTextTranslateTextInput!
}

input SpeakTranslatedIdentifiedTextIdentifyTextInput {
  key: String!
}

input SpeakTranslatedIdentifiedTextTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
}

input SpeakTranslatedIdentifiedTextConvertTextToSpeechInput {
  voiceID: String!
}

input SpeakTranslatedIdentifiedTextInput {
  identifyText: SpeakTranslatedIdentifiedTextIdentifyTextInput!
  translateText: SpeakTranslatedIdentifiedTextTranslateTextInput!
  convertTextToSpeech: SpeakTranslatedIdentifiedTextConvertTextToSpeechInput!
}

input SpeakTranslatedLabelTextIdentifyLabelsInput {
  key: String!
}

input SpeakTranslatedLabelTextTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
}

input SpeakTranslatedLabelTextConvertTextToSpeechInput {
  voiceID: String!
}

input SpeakTranslatedLabelTextInput {
  identifyLabels: SpeakTranslatedLabelTextIdentifyLabelsInput!
  translateText: SpeakTranslatedLabelTextTranslateTextInput!
  convertTextToSpeech: SpeakTranslatedLabelTextConvertTextToSpeechInput!
}

input SpeakTranslatedTextTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
  text: String!
}

input SpeakTranslatedTextConvertTextToSpeechInput {
  voiceID: String!
}

input SpeakTranslatedTextInput {
  translateText: SpeakTranslatedTextTranslateTextInput!
  convertTextToSpeech: SpeakTranslatedTextConvertTextToSpeechInput!
}
"
`;

exports[`can use actions individually and in supported sequences 2`] = `
{
  "Conditions": {
    "HasEnvironmentParameter": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "referencetotransformerrootstackenv10C5A902Ref",
            },
            "NONE",
          ],
        },
      ],
    },
  },
  "Parameters": {
    "referencetotransformerrootstackGraphQLAPI20497F53ApiId": {
      "Type": "String",
    },
    "referencetotransformerrootstackS3DeploymentBucket7592718ARef": {
      "Type": "String",
    },
    "referencetotransformerrootstackS3DeploymentRootKeyA71EA735Ref": {
      "Type": "String",
    },
    "referencetotransformerrootstackenv10C5A902Ref": {
      "Type": "String",
    },
  },
  "Resources": {
    "LambdaDataSource": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "LambdaConfig": {
          "LambdaFunctionArn": {
            "Fn::GetAtt": [
              "predictionsLambda8B880A74",
              "Arn",
            ],
          },
        },
        "Name": "LambdaDataSource",
        "ServiceRoleArn": {
          "Fn::GetAtt": [
            "predictionsIAMRole5BB74A99",
            "Arn",
          ],
        },
        "Type": "AWS_LAMBDA",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "LambdaDataSourceServiceRole81BB3362": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "LambdaDataSourceServiceRoleDefaultPolicy00CC76B1": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "predictionsLambda8B880A74",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "predictionsLambda8B880A74",
                          "Arn",
                        ],
                      },
                      ":*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LambdaDataSourceServiceRoleDefaultPolicy00CC76B1",
        "Roles": [
          {
            "Ref": "LambdaDataSourceServiceRole81BB3362",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "PredictionsLambdaAccess4D9DA807": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "predictionsLambda8B880A74",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "PredictionsLambdaAccess4D9DA807",
        "Roles": [
          {
            "Ref": "predictionsIAMRole5BB74A99",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "PredictionsStorageAccess68CD5140": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:GetObject",
              "Effect": "Allow",
              "Resource": {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "arn:aws:s3:::myStorage\${hash}-\${env}/public/*",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "arn:aws:s3:::myStorage\${hash}/public/*",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "PredictionsStorageAccess68CD5140",
        "Roles": [
          {
            "Ref": "predictionsIAMRole5BB74A99",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "QueryconvertTextToSpeechResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "convertTextToSpeech",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "convertTextToSpeechFunctionconvertTextToSpeechFunctionAppSyncFunction15BC20B8",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QueryidentifyLabelsResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "identifyLabels",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "identifyLabelsFunctionidentifyLabelsFunctionAppSyncFunction7C2A1E61",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QueryidentifyTextResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "identifyText",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "identifyTextFunctionidentifyTextFunctionAppSyncFunction7877885A",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QueryspeakTranslatedIdentifiedTextResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "speakTranslatedIdentifiedText",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "identifyTextFunctionidentifyTextFunctionAppSyncFunction7877885A",
                "FunctionId",
              ],
            },
            {
              "Fn::GetAtt": [
                "translateTextFunctiontranslateTextFunctionAppSyncFunction77C9D7A9",
                "FunctionId",
              ],
            },
            {
              "Fn::GetAtt": [
                "convertTextToSpeechFunctionconvertTextToSpeechFunctionAppSyncFunction15BC20B8",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QueryspeakTranslatedLabelTextResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "speakTranslatedLabelText",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "identifyLabelsFunctionidentifyLabelsFunctionAppSyncFunction7C2A1E61",
                "FunctionId",
              ],
            },
            {
              "Fn::GetAtt": [
                "translateTextFunctiontranslateTextFunctionAppSyncFunction77C9D7A9",
                "FunctionId",
              ],
            },
            {
              "Fn::GetAtt": [
                "convertTextToSpeechFunctionconvertTextToSpeechFunctionAppSyncFunction15BC20B8",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QueryspeakTranslatedTextResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "speakTranslatedText",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "translateTextFunctiontranslateTextFunctionAppSyncFunction77C9D7A9",
                "FunctionId",
              ],
            },
            {
              "Fn::GetAtt": [
                "convertTextToSpeechFunctionconvertTextToSpeechFunctionAppSyncFunction15BC20B8",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "QuerytranslateTextResolver": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "FieldName": "translateText",
        "Kind": "PIPELINE",
        "PipelineConfig": {
          "Functions": [
            {
              "Fn::GetAtt": [
                "translateTextFunctiontranslateTextFunctionAppSyncFunction77C9D7A9",
                "FunctionId",
              ],
            },
          ],
        },
        "RequestMappingTemplate": {
          "Fn::Join": [
            "
",
            [
              {
                "Fn::If": [
                  "HasEnvironmentParameter",
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}-\${env}"))",
                      {
                        "env": {
                          "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                        },
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                  {
                    "Fn::Sub": [
                      "$util.qr($ctx.stash.put("s3Bucket", "myStorage\${hash}"))",
                      {
                        "hash": {
                          "Fn::Select": [
                            3,
                            {
                              "Fn::Split": [
                                "-",
                                {
                                  "Ref": "AWS::StackName",
                                },
                              ],
                            },
                          ],
                        },
                      },
                    ],
                  },
                ],
              },
              "$util.qr($ctx.stash.put("isList", false))
{}",
            ],
          ],
        },
        "ResponseMappingTemplate": "## If the result is a list return the result as a list **
#if( $ctx.stash.get("isList") )
  #set( $result = $ctx.result.split("[ ,]+") )
  $util.toJson($result)
#else
  $util.toJson($ctx.result)
#end",
        "TypeName": "Query",
      },
      "Type": "AWS::AppSync::Resolver",
    },
    "RekognitionDataSource": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "HttpConfig": {
          "AuthorizationConfig": {
            "AuthorizationType": "AWS_IAM",
            "AwsIamConfig": {
              "SigningRegion": {
                "Fn::Sub": "\${AWS::Region}",
              },
              "SigningServiceName": "rekognition",
            },
          },
          "Endpoint": {
            "Fn::Sub": "https://rekognition.\${AWS::Region}.amazonaws.com",
          },
        },
        "Name": "RekognitionDataSource",
        "ServiceRoleArn": {
          "Fn::GetAtt": [
            "predictionsIAMRole5BB74A99",
            "Arn",
          ],
        },
        "Type": "HTTP",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "RekognitionDataSourceServiceRole3628B5DB": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "TranslateDataSource": {
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "HttpConfig": {
          "AuthorizationConfig": {
            "AuthorizationType": "AWS_IAM",
            "AwsIamConfig": {
              "SigningRegion": {
                "Fn::Sub": "\${AWS::Region}",
              },
              "SigningServiceName": "translate",
            },
          },
          "Endpoint": {
            "Fn::Sub": "https://translate.\${AWS::Region}.amazonaws.com",
          },
        },
        "Name": "TranslateDataSource",
        "ServiceRoleArn": {
          "Fn::GetAtt": [
            "predictionsIAMRole5BB74A99",
            "Arn",
          ],
        },
        "Type": "HTTP",
      },
      "Type": "AWS::AppSync::DataSource",
    },
    "TranslateDataSourceServiceRole2FE48B83": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "convertTextToSpeechFunctionconvertTextToSpeechFunctionAppSyncFunction15BC20B8": {
      "DependsOn": [
        "LambdaDataSource",
      ],
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "DataSourceName": {
          "Fn::GetAtt": [
            "LambdaDataSource",
            "Name",
          ],
        },
        "FunctionVersion": "2018-05-29",
        "Name": "convertTextToSpeechFunction",
        "RequestMappingTemplate": "#set( $bucketName = $ctx.stash.get("s3Bucket") )
$util.qr($ctx.stash.put("isList", false))
#set( $text = $util.defaultIfNull($ctx.args.input.convertTextToSpeech.text, $ctx.prev.result) )
{
  "version": "2018-05-29",
  "operation": "Invoke",
  "payload":   $util.toJson({
  "uuid": "$util.autoId()",
  "action": "convertTextToSpeech",
  "voiceID": $ctx.args.input.convertTextToSpeech.voiceID,
  "text": $text
})
}",
        "ResponseMappingTemplate": "#if( $ctx.error )
$util.error($ctx.error.message, $ctx.error.type)
#end
#set( $response = $util.parseJson($ctx.result) )
$util.toJson($ctx.result.url)",
      },
      "Type": "AWS::AppSync::FunctionConfiguration",
    },
    "identifyLabelsAccess7BFAF94B": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "rekognition:DetectLabels",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "identifyLabelsAccess7BFAF94B",
        "Roles": [
          {
            "Ref": "predictionsIAMRole5BB74A99",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "identifyLabelsFunctionidentifyLabelsFunctionAppSyncFunction7C2A1E61": {
      "DependsOn": [
        "RekognitionDataSource",
      ],
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "DataSourceName": {
          "Fn::GetAtt": [
            "RekognitionDataSource",
            "Name",
          ],
        },
        "FunctionVersion": "2018-05-29",
        "Name": "identifyLabelsFunction",
        "RequestMappingTemplate": "#set( $bucketName = $ctx.stash.get("s3Bucket") )
#set( $identifyLabelKey = $ctx.args.input.identifyLabels.key )
$util.qr($ctx.stash.put("isList", true))
#set( $identifyLabelsPayload = {
  "version": "2018-05-29",
  "method": "POST",
  "resourcePath": "/",
  "params": {
      "body": {
          "Image": {
              "S3Object": {
                  "Bucket": "$bucketName",
                  "Name": "public/$identifyLabelKey"
        }
      },
          "MaxLabels": 10,
          "MinConfidence": 55
    },
      "headers": {
          "Content-Type": "application/x-amz-json-1.1",
          "X-Amz-Target": "RekognitionService.DetectLabels"
    }
  }
} )
$util.toJson($identifyLabelsPayload)",
        "ResponseMappingTemplate": "#if( $ctx.error )
$util.error($ctx.error.message)
#end
#if( $ctx.result.statusCode == 200 )
  #set( $labels = "" )
  #set( $result = $util.parseJson($ctx.result.body) )
  #foreach( $label in $result.Labels )
    #set( $labels = "$labels$label.Name, " )
  #end
  $util.toJson($labels.replaceAll(", $", ""))
#else
$util.error($ctx.result.body)
#end",
      },
      "Type": "AWS::AppSync::FunctionConfiguration",
    },
    "identifyTextAccess5A2D7702": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "rekognition:DetectText",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "identifyTextAccess5A2D7702",
        "Roles": [
          {
            "Ref": "predictionsIAMRole5BB74A99",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "identifyTextFunctionidentifyTextFunctionAppSyncFunction7877885A": {
      "DependsOn": [
        "RekognitionDataSource",
      ],
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "DataSourceName": {
          "Fn::GetAtt": [
            "RekognitionDataSource",
            "Name",
          ],
        },
        "FunctionVersion": "2018-05-29",
        "Name": "identifyTextFunction",
        "RequestMappingTemplate": "#set( $bucketName = $ctx.stash.get("s3Bucket") )
#set( $identityTextKey = $ctx.args.input.identifyText.key )
#set( $identifyTextPayload = {
  "version": "2018-05-29",
  "method": "POST",
  "resourcePath": "/",
  "params": {
      "body": {
          "Image": {
              "S3Object": {
                  "Bucket": "$bucketName",
                  "Name": "public/$identityTextKey"
        }
      }
    },
      "headers": {
          "Content-Type": "application/x-amz-json-1.1",
          "X-Amz-Target": "RekognitionService.DetectText"
    }
  }
} )
$util.toJson($identifyTextPayload)",
        "ResponseMappingTemplate": "#if( $ctx.error )
$util.error($ctx.error.message)
#end
#if( $ctx.result.statusCode == 200 )
  #set( $results = $util.parseJson($ctx.result.body) )
  #set( $finalResult = "" )
  #foreach( $item in $results.TextDetections )
    #if( $item.Type == "LINE" )
      #set( $finalResult = "$finalResult$item.DetectedText " )
    #end
  #end
$util.toJson($finalResult.trim())
#else
$utils.error($ctx.result.body)
#end",
      },
      "Type": "AWS::AppSync::FunctionConfiguration",
    },
    "predictionsIAMRole5BB74A99": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "appsync.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "RoleName": {
          "Fn::If": [
            "HasEnvironmentParameter",
            {
              "Fn::Join": [
                "-",
                [
                  "predictionsIAMRole",
                  {
                    "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
                  },
                  {
                    "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "-",
                [
                  "predictionsIAMRole",
                  {
                    "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
                  },
                ],
              ],
            },
          ],
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "predictionsLambda8B880A74": {
      "DependsOn": [
        "predictionsLambdaIAMRoleB8AC96D3",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "referencetotransformerrootstackS3DeploymentBucket7592718ARef",
          },
          "S3Key": {
            "Fn::Join": [
              "",
              [
                {
                  "Ref": "referencetotransformerrootstackS3DeploymentRootKeyA71EA735Ref",
                },
                "/functions/predictionsLambdaFunction.zip",
              ],
            ],
          },
        },
        "Handler": "predictionsLambda.handler",
        "Role": {
          "Fn::GetAtt": [
            "predictionsLambdaIAMRoleB8AC96D3",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "predictionsLambdaIAMRoleB8AC96D3": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "polly:SynthesizeSpeech",
                  "Effect": "Allow",
                  "Resource": "*",
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "PollyAccess",
          },
        ],
        "RoleName": {
          "Fn::If": [
            "HasEnvironmentParameter",
            {
              "Fn::Join": [
                "-",
                [
                  "predictionsLambdaIAMRole",
                  {
                    "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
                  },
                  {
                    "Ref": "referencetotransformerrootstackenv10C5A902Ref",
                  },
                ],
              ],
            },
            {
              "Fn::Join": [
                "-",
                [
                  "predictionsLambdaIAMRole",
                  {
                    "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
                  },
                ],
              ],
            },
          ],
        },
      },
      "Type": "AWS::IAM::Role",
    },
    "translateTextAccess74D3AE90": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "translate:TranslateText",
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "translateTextAccess74D3AE90",
        "Roles": [
          {
            "Ref": "predictionsIAMRole5BB74A99",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "translateTextFunctiontranslateTextFunctionAppSyncFunction77C9D7A9": {
      "DependsOn": [
        "TranslateDataSource",
      ],
      "Properties": {
        "ApiId": {
          "Ref": "referencetotransformerrootstackGraphQLAPI20497F53ApiId",
        },
        "DataSourceName": {
          "Fn::GetAtt": [
            "TranslateDataSource",
            "Name",
          ],
        },
        "FunctionVersion": "2018-05-29",
        "Name": "translateTextFunction",
        "RequestMappingTemplate": "#set( $text = $util.defaultIfNull($ctx.args.input.translateText.text, $ctx.prev.result) )
#set( $translateTextPayload = {
  "version": "2018-05-29",
  "method": "POST",
  "resourcePath": "/",
  "params": {
      "body": {
          "SourceLanguageCode": $ctx.args.input.translateText.sourceLanguage,
          "TargetLanguageCode": $ctx.args.input.translateText.targetLanguage,
          "Text": $text
    },
      "headers": {
          "Content-Type": "application/x-amz-json-1.1",
          "X-Amz-Target": "AWSShineFrontendService_20170701.TranslateText"
    }
  }
} )
$util.toJson($translateTextPayload)",
        "ResponseMappingTemplate": "#if( $ctx.error )
$util.error($ctx.error.message)
#end
#if( $ctx.result.statusCode == 200 )
  #set( $result = $util.parseJson($ctx.result.body) )
$util.toJson($result.TranslatedText)
#else
$util.error($ctx.result.body)
#end",
      },
      "Type": "AWS::AppSync::FunctionConfiguration",
    },
  },
}
`;

exports[`lambda function is added to pipeline when lambda dependent action is added 1`] = `
"type Query {
  speakTranslatedText(input: SpeakTranslatedTextInput!): String
}

input SpeakTranslatedTextTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
  text: String!
}

input SpeakTranslatedTextConvertTextToSpeechInput {
  voiceID: String!
}

input SpeakTranslatedTextInput {
  translateText: SpeakTranslatedTextTranslateTextInput!
  convertTextToSpeech: SpeakTranslatedTextConvertTextToSpeechInput!
}
"
`;

exports[`return type is a list based on the action 1`] = `
"type Query {
  translateLabels(input: TranslateLabelsInput!): [String]
}

input TranslateLabelsIdentifyLabelsInput {
  key: String!
}

input TranslateLabelsTranslateTextInput {
  sourceLanguage: String!
  targetLanguage: String!
}

input TranslateLabelsInput {
  identifyLabels: TranslateLabelsIdentifyLabelsInput!
  translateText: TranslateLabelsTranslateTextInput!
}
"
`;
