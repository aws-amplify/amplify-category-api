version: 0.2
env:
  shell: bash
  compute-type: BUILD_GENERAL1_MEDIUM

batch:
  fast-fail: false
  build-graph:
    - identifier: build_linux
      buildspec: codebuild_specs/build_linux.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
    - identifier: test
      buildspec: codebuild_specs/test.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
      depend-on:
        - build_linux
    - identifier: mock_e2e_tests
      buildspec: codebuild_specs/mock_e2e_tests.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
      depend-on:
        - build_linux
    - identifier: verify_cdk_version
      buildspec: codebuild_specs/validate_cdk_version.yml
      depend-on:
        - build_linux
    - identifier: verify_api_extract
      buildspec: codebuild_specs/verify_api_extract.yml
      depend-on:
        - build_linux
    - identifier: verify_yarn_lock
      buildspec: codebuild_specs/verify_yarn_lock.yml
      depend-on:
        - build_linux
    - identifier: publish_to_local_registry
      buildspec: codebuild_specs/publish_to_local_registry.yml
      depend-on:
        - build_linux
    - identifier: run_e2e_tests
      buildspec: codebuild_specs/run_e2e_tests.yml
      env:
        compute-type: BUILD_GENERAL1_LARGE
        TEST_SUITE: custom-transformers.test.ts
        CLI_REGION: us-west-2
      debug-session: true
      depend-on:
        - publish_to_local_registry