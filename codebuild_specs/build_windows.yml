version: 0.2
env:
  shell: powershell.exe
  variables:
    NODE_OPTIONS: --max-old-space-size=8096
phases:
  pre_build:
    commands:
      - choco install -fy nodejs-lts --version=24.12.0
      - |
        # Install Spectre-mitigated libraries for VS2019
        & "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" modify --installPath "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools" --add Microsoft.VisualStudio.Component.VC.Spectre.Mitigations --quiet --norestart --wait
      - |
        $nodeVersion = node -v
        Write-Host "Node version: $nodeVersion"
  build:
    commands:
      - yarn run production-build
      - yarn build-tests
artifacts:
  files:
    - 'shared-scripts.sh'
